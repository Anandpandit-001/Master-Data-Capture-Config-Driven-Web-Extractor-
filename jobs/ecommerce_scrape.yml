# ===============================================
# Job Config for: scrapingcourse.com/ecommerce
# ===============================================

site:
  name: "scraping-course-ecommerce"
  base_url: "https://www.scrapingcourse.com"

# This site is public, so no authentication is needed.
auth:
  session_file: null

# Standard runtime settings.
runtime:
  sleep_ms_between_pages: 500
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36"

module:
  name: "EcommerceProducts"
  entities:
    # --- Stage 1: Scrape the main product list page ---
    - name: "ProductList"
      url: "/ecommerce/"
      # Each product is a list item within the main product grid
      row_selector: "ul.products li"
      fields:
        # Extracts the text from the <h2> tag with the product title
        product_name: "h2.woocommerce-loop-product__title"
        # Extracts the text from the <span> tag containing the price
        price: "span.price"
        # Extracts the URL from the 'href' attribute of the main link
        detail_link: "a.woocommerce-LoopProduct-link@href"

    # --- Stage 2: Follow links to scrape product detail pages ---
    - name: "ProductDetail"
      # This tells the scraper to use the URLs collected in the 'detail_link'
      # field from the 'ProductList' entity as its input.
      follow_from: "ProductList.detail_link"
      # On the detail page, the main container for the product is <div class="product">
      row_selector: "div.product"
      fields:
        # Extracts the SKU from the <span class="sku">
        sku: "span.sku"
        # Extracts the short description text
        description: "div.woocommerce-product-details__short-description > p"
        # Extracts the category from the last link in the breadcrumb trail
        category: ".woocommerce-breadcrumb > a:last-child"

output:
  dir: "./output"
  formats: ["csv", "json"]
  # Use 'sku' as the primary key to deduplicate results for the detail entity
  primary_key: ["sku"]

reporting:
  p95_target_seconds: 120